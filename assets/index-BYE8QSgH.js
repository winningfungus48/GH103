var G=Object.defineProperty,I=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var S=(o,r,n)=>r in o?G(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,_=(o,r)=>{for(var n in r||(r={}))T.call(r,n)&&S(o,n,r[n]);if(M)for(var n of M(r))F.call(r,n)&&S(o,n,r[n]);return o},x=(o,r)=>I(o,V(r));import{j as a,p as D,q as Y}from"./index-DMZmBJst.js";import{d as K,r as C}from"./router-vendor-BfUoC7-o.js";import{u as U,G as z,M as H}from"./useWelcomeModal-CbTDL-GU.js";import{u as J}from"./useDailySeed-CCpBxUz8.js";import"./react-vendor-C0DUGSOM.js";import"./helmet-vendor-CTOi22zu.js";import"./index-C9qaKABp.js";const Q="_container_1ogf0_1",X="_board_1ogf0_75",Z="_row_1ogf0_97",ee="_tile_1ogf0_109",te="_current_1ogf0_185",ae="_message_1ogf0_195",se="_numberPadContainer_1ogf0_213",re="_numberPad_1ogf0_213",ne="_numberBtn_1ogf0_241",oe="_operatorPad_1ogf0_345",le="_operatorBtn_1ogf0_359",ce="_actionButtons_1ogf0_463",ie="_actionBtn_1ogf0_475",ue="_active_1ogf0_527",de="_stats_1ogf0_557",me="_stat_1ogf0_557",be="_statValue_1ogf0_585",ge="_statLabel_1ogf0_599",he="_playAgainBtn_1ogf0_613",fe="_closeBtn_1ogf0_649",s={container:Q,board:X,row:Z,tile:ee,current:te,message:ae,numberPadContainer:se,numberPad:re,numberBtn:ne,operatorPad:oe,operatorBtn:le,actionButtons:ce,actionBtn:ie,active:ue,stats:de,stat:me,statValue:be,statLabel:ge,playAgainBtn:he,closeBtn:fe},E={secretEquation:"",secretResult:0,currentRow:0,currentCol:0,gameOver:!1,gameWon:!1,maxAttempts:6,equationLength:5,board:Array.from({length:6},()=>Array.from({length:5},()=>({value:"",status:""}))),numberPadColors:{}},pe=["+","-","×","÷"],_e=["0","1","2","3","4","5","6","7","8","9"],q=["Mathematical Master!","Equation Expert!","Number Ninja!","Calculation Champion!","Math Wizard!","Problem Solver!","Arithmetic Ace!","Formula Finder!"];function xe(o){const r=(()=>{let u=o;return()=>(u=(u*9301+49297)%233280,u/233280)})(),n=Math.floor(r()*9)+1,e=Math.floor(r()*9)+1,d=pe[Math.floor(r()*4)];let i,m;if(d==="+")i=n+e,m=`${n}+${e}=${i}`;else if(d==="-")i=n-e,m=`${n}-${e}=${i}`;else if(d==="×")i=n*e,m=`${n}×${e}=${i}`;else if(d==="÷"){i=n;const u=e;m=`${i*u}÷${u}=${i}`}return{equation:m,result:i}}function ve(o){try{const r=o.replace(/×/g,"*").replace(/÷/g,"/");return Function(`'use strict'; return (${r})`)()}catch(r){return null}}function Ce(o,r,n){const e=[],d=ve(o),i=o===r,m=d===n;for(let u=0;u<o.length;u++){const h=o[u],b=r[u];h===b?e.push({value:h,status:"correct"}):r.includes(h)?e.push({value:h,status:"present"}):e.push({value:h,status:"absent"})}return{result:e,isCorrect:i,evaluatesCorrectly:m}}const Se=({instructions:o})=>{const r=K(),n=J(),[e,d]=C.useState(E),[i,m]=C.useState(""),[u,h]=C.useState(!1),[b,w]=C.useState({}),{WelcomeModal:R,gameContainerRef:A}=U("Mathle",o);C.useEffect(()=>{if(n!==null){const{equation:t,result:c}=xe(n);d(l=>x(_({},l),{secretEquation:t,secretResult:c}))}},[n]);const g=t=>{e.gameOver||e.currentCol>=e.equationLength||d(c=>{const l=[...c.board];return l[c.currentRow][c.currentCol]={value:t,status:""},x(_({},c),{board:l,currentCol:c.currentCol+1})})},y=()=>{e.currentCol!==0&&d(t=>{const c=[...t.board];return c[t.currentRow][t.currentCol-1]={value:"",status:""},x(_({},t),{board:c,currentCol:t.currentCol-1})})},N=()=>{if(e.currentCol!==e.equationLength)return;const t=e.board[e.currentRow].map(p=>p.value).join("");if(t.length!==e.equationLength)return;if(!/^\d+[+\-×÷]\d+=\d+$/.test(t)){m("Invalid equation format! Use: number+number=result"),setTimeout(()=>m(""),3e3);return}const{result:l,isCorrect:f,evaluatesCorrectly:$}=Ce(t,e.secretEquation,e.secretResult),v=[...e.board];v[e.currentRow]=l;const k=_({},e.numberPadColors);l.forEach(p=>{p.value&&(k[p.value]=p.status)});const j=f,B=j||e.currentRow===e.maxAttempts-1;d(p=>x(_({},p),{board:v,currentRow:p.currentRow+1,currentCol:0,gameOver:B,gameWon:j,numberPadColors:k})),B&&O(j,$)},O=(t,c)=>{const l=D(),f=x(_({},l),{gamesPlayed:l.gamesPlayed+1,gamesWon:l.gamesWon+(t?1:0),currentStreak:t?l.currentStreak+1:0,maxStreak:t?Math.max(l.maxStreak,l.currentStreak+1):l.maxStreak});Y(f);const $=q[Math.floor(Math.random()*q.length)];let v=t?`You found the equation in ${e.currentRow+1} tries!`:`The equation was: ${e.secretEquation}`;!t&&!c&&(v+=" (Your equation didn't evaluate correctly)"),w({title:t?$:"Game Over",message:v,stats:f}),h(!0)},P=()=>{h(!1),r("/")},L=()=>{h(!1),d(E),m("")},W=t=>{e.gameOver||(console.log("Mathle keydown:",t.key,"Focus element:",document.activeElement),t.key>="0"&&t.key<="9"||t.key==="+"||t.key==="-"?g(t.key):t.key==="*"?g("×"):t.key==="/"?g("÷"):t.key==="="?g("="):t.key==="Enter"?N():t.key==="Backspace"&&y())};return a.jsxs(z,{children:[a.jsxs("div",{className:s.container,ref:A,onKeyDown:W,tabIndex:0,role:"application","aria-label":"Mathle game","aria-live":"polite","aria-atomic":"true",style:{outline:"2px solid transparent"},onFocus:t=>t.target.style.outline="2px solid #007bff",onBlur:t=>t.target.style.outline="2px solid transparent",children:[a.jsx("div",{className:"sr-only","aria-live":"polite",children:e.gameOver?e.gameWon?"Congratulations! You won the game!":`Game over. The equation was ${e.secretEquation}`:`Attempt ${e.currentRow+1} of ${e.maxAttempts}, ${e.currentCol} characters entered`}),a.jsx("div",{className:s.board,role:"grid","aria-label":"Mathle game board",children:e.board.map((t,c)=>a.jsx("div",{className:`${s.row} ${c===e.currentRow?s.current:""}`,role:"row","aria-label":`Row ${c+1}`,children:t.map((l,f)=>a.jsx("div",{className:`${s.tile} ${l.status} ${c===e.currentRow&&f===e.currentCol?s.current:""}`,role:"gridcell","aria-label":`Position ${f+1}, ${l.value||"empty"}`,tabIndex:0,children:l.value},f))},c))}),i&&a.jsx("div",{className:s.message,role:"alert","aria-live":"assertive",children:i}),a.jsxs("div",{className:s.numberPadContainer,children:[a.jsx("div",{className:s.numberPad,role:"group","aria-label":"Number pad",children:_e.map(t=>a.jsx("button",{className:`${s.numberBtn} ${e.numberPadColors[t]||""}`,onClick:()=>g(t),disabled:e.gameOver,"aria-label":`Enter digit ${t}`,tabIndex:0,children:t},t))}),a.jsxs("div",{className:s.operatorPad,role:"group","aria-label":"Operator pad",children:[a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["+"]||""}`,onClick:()=>g("+"),disabled:e.gameOver,"aria-label":"Enter plus operator",tabIndex:0,children:"+"}),a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["-"]||""}`,onClick:()=>g("-"),disabled:e.gameOver,"aria-label":"Enter minus operator",tabIndex:0,children:"-"}),a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["×"]||""}`,onClick:()=>g("×"),disabled:e.gameOver,"aria-label":"Enter multiply operator",tabIndex:0,children:"×"}),a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["÷"]||""}`,onClick:()=>g("÷"),disabled:e.gameOver,"aria-label":"Enter divide operator",tabIndex:0,children:"÷"}),a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["="]||""}`,onClick:()=>g("="),disabled:e.gameOver,"aria-label":"Enter equals sign",tabIndex:0,children:"="})]}),a.jsxs("div",{className:s.actionButtons,role:"group","aria-label":"Action buttons",children:[a.jsx("button",{className:s.actionBtn,onClick:y,disabled:e.gameOver,"aria-label":"Delete last character",tabIndex:0,children:"⌫"}),a.jsx("button",{className:`${s.actionBtn} ${e.currentCol===e.equationLength?s.active:""}`,onClick:N,disabled:e.gameOver||e.currentCol!==e.equationLength,"aria-label":"Submit equation",tabIndex:0,children:"Enter"})]})]})]}),a.jsxs(H,{open:u,onClose:P,title:b.title,children:[a.jsx("p",{children:b.message}),b.stats&&a.jsxs("div",{className:s.stats,children:[a.jsxs("div",{className:s.stat,children:[a.jsx("span",{className:s.statValue,children:b.stats.gamesPlayed}),a.jsx("span",{className:s.statLabel,children:"Games"})]}),a.jsxs("div",{className:s.stat,children:[a.jsxs("span",{className:s.statValue,children:[b.stats.gamesPlayed>0?Math.round(b.stats.gamesWon/b.stats.gamesPlayed*100):0,"%"]}),a.jsx("span",{className:s.statLabel,children:"Win Rate"})]}),a.jsxs("div",{className:s.stat,children:[a.jsx("span",{className:s.statValue,children:b.stats.currentStreak}),a.jsx("span",{className:s.statLabel,children:"Current Streak"})]}),a.jsxs("div",{className:s.stat,children:[a.jsx("span",{className:s.statValue,children:b.stats.maxStreak}),a.jsx("span",{className:s.statLabel,children:"Max Streak"})]})]}),a.jsxs("div",{slot:"buttons",children:[a.jsx("button",{onClick:L,className:s.playAgainBtn,children:"Play Again"}),a.jsx("button",{onClick:P,className:s.closeBtn,children:"Close"})]})]}),a.jsx(R,{})]})};export{Se as default};
