var W=Object.defineProperty,I=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var M=(n,r,l)=>r in n?W(n,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[r]=l,p=(n,r)=>{for(var l in r||(r={}))T.call(r,l)&&M(n,l,r[l]);if(S)for(var l of S(r))F.call(r,l)&&M(n,l,r[l]);return n},C=(n,r)=>I(n,V(r));import{j as a,o as D,p as Y}from"./index-Vp0nESHb.js";import{u as K,r as f}from"./router-vendor-DaPjFkUa.js";import{u as z,G as H}from"./useWelcomeModal-CEEjzKFt.js";import{u as U}from"./useDailySeed-Dkv3_iLV.js";import{M as J}from"./Modal-Cofigee_.js";import"./react-vendor-C0DUGSOM.js";import"./helmet-vendor-DEbyD_Xj.js";import"./index-C9qaKABp.js";const Q="_container_14dd6_1",X="_board_14dd6_75",Z="_row_14dd6_97",ee="_tile_14dd6_109",te="_current_14dd6_187",ae="_message_14dd6_197",se="_numberPadContainer_14dd6_215",re="_numberPad_14dd6_215",ne="_numberBtn_14dd6_243",oe="_operatorPad_14dd6_347",le="_operatorBtn_14dd6_361",ce="_actionButtons_14dd6_465",ie="_actionBtn_14dd6_477",ue="_active_14dd6_529",de="_stats_14dd6_559",me="_stat_14dd6_559",be="_statValue_14dd6_587",he="_statLabel_14dd6_601",ge="_playAgainBtn_14dd6_615",pe="_closeBtn_14dd6_651",s={container:Q,board:X,row:Z,tile:ee,current:te,message:ae,numberPadContainer:se,numberPad:re,numberBtn:ne,operatorPad:oe,operatorBtn:le,actionButtons:ce,actionBtn:ie,active:ue,stats:de,stat:me,statValue:be,statLabel:he,playAgainBtn:ge,closeBtn:pe},q={secretEquation:"",secretResult:0,currentRow:0,currentCol:0,gameOver:!1,gameWon:!1,maxAttempts:6,equationLength:8,board:Array.from({length:6},()=>Array.from({length:8},()=>({value:"",status:""}))),numberPadColors:{}},_e=["0","1","2","3","4","5","6","7","8","9"],E=["Mathematical Master!","Equation Expert!","Number Ninja!","Calculation Champion!","Math Wizard!","Problem Solver!","Arithmetic Ace!","Formula Finder!"];function xe(n){const r=(()=>{let d=n;return()=>(d=(d*9301+49297)%233280,d/233280)})(),l=["1+2*3=7","4+5-2=7","3*4/2=6","8-3+1=6","2*3+1=7","9-4*1=5","6/2+3=6","5+1*2=7","7-2+1=6","4*2-1=7"],e=l[Math.floor(r()*l.length)];e.replace(/=/g,"===").replace(/\*/g,"*").replace(/\//g,"/");const u=e.split("=")[0],_=Function(`'use strict'; return (${u})`)();return{equation:e,result:_}}function Ce(n){try{const r=n.split("=")[0];return Function(`'use strict'; return (${r})`)()}catch(r){return null}}function ve(n,r,l){const e=[],u=Ce(n),_=n===r,d=u===l;for(let x=0;x<n.length;x++){const m=n[x],i=r[x];m===i?e.push({value:m,status:"correct"}):r.includes(m)?e.push({value:m,status:"present"}):e.push({value:m,status:"absent"})}return{result:e,isCorrect:_,evaluatesCorrectly:d}}const Me=({instructions:n})=>{const r=K(),l=U(),[e,u]=f.useState(q),[_,d]=f.useState(""),[x,m]=f.useState(!1),[i,w]=f.useState({}),{WelcomeModal:R,gameContainerRef:A}=z("Mathle",n);f.useEffect(()=>{if(l!==null){const{equation:t,result:c}=xe(l);console.log("Generated secret equation:",t,"result:",c),u(o=>C(p({},o),{secretEquation:t,secretResult:c}))}},[l]);const h=t=>{e.gameOver||e.currentCol>=e.equationLength||u(c=>{const o=[...c.board];return o[c.currentRow][c.currentCol]={value:t,status:""},C(p({},c),{board:o,currentCol:c.currentCol+1})})},N=()=>{e.currentCol!==0&&u(t=>{const c=[...t.board];return c[t.currentRow][t.currentCol-1]={value:"",status:""},C(p({},t),{board:c,currentCol:t.currentCol-1})})},k=()=>{if(e.currentCol!==e.equationLength)return;const t=e.board[e.currentRow].map(g=>g.value).join("");if(t.length!==e.equationLength)return;if(!/^[\d+\-*/]{7}=\d{1}$/.test(t)){d("Invalid equation format! Must be exactly 8 characters (e.g., 1+2*3=7)"),setTimeout(()=>d(""),3e3);return}console.log("Current guess:",t),console.log("Secret equation:",e.secretEquation),console.log("Secret result:",e.secretResult);const{result:o,isCorrect:b,evaluatesCorrectly:y}=ve(t,e.secretEquation,e.secretResult);console.log("Check result:",o),console.log("Is correct:",b),console.log("Evaluates correctly:",y);const v=[...e.board];v[e.currentRow]=o;const B=p({},e.numberPadColors);o.forEach(g=>{g.value&&(B[g.value]=g.status)});const j=b,$=j||e.currentRow===e.maxAttempts-1;u(g=>C(p({},g),{board:v,currentRow:g.currentRow+1,currentCol:0,gameOver:$,gameWon:j,numberPadColors:B})),$&&L(j,y)},L=(t,c)=>{const o=D(),b=C(p({},o),{gamesPlayed:o.gamesPlayed+1,gamesWon:o.gamesWon+(t?1:0),currentStreak:t?o.currentStreak+1:0,maxStreak:t?Math.max(o.maxStreak,o.currentStreak+1):o.maxStreak});Y(b);const y=E[Math.floor(Math.random()*E.length)];let v=t?`You found the equation in ${e.currentRow+1} tries!`:`The equation was: ${e.secretEquation}`;!t&&!c&&(v+=" (Your equation didn't evaluate correctly)"),w({title:t?y:"Game Over",message:v,stats:b}),m(!0)},P=()=>{m(!1),r("/")},O=()=>{m(!1),u(q),d("")},G=t=>{e.gameOver||(console.log("Mathle keydown:",t.key,"Focus element:",document.activeElement),t.key>="0"&&t.key<="9"||t.key==="+"||t.key==="-"||t.key==="*"||t.key==="/"||t.key==="="?h(t.key):t.key==="Enter"?k():t.key==="Backspace"&&N())};return a.jsxs(H,{children:[a.jsxs("div",{className:s.container,ref:A,onKeyDown:G,tabIndex:0,role:"application","aria-label":"Mathle game","aria-live":"polite","aria-atomic":"true",style:{outline:"2px solid transparent"},onFocus:t=>t.target.style.outline="2px solid #007bff",onBlur:t=>t.target.style.outline="2px solid transparent",children:[a.jsx("div",{className:"sr-only","aria-live":"polite",children:e.gameOver?e.gameWon?"Congratulations! You won the game!":`Game over. The equation was ${e.secretEquation}`:`Attempt ${e.currentRow+1} of ${e.maxAttempts}, ${e.currentCol} characters entered`}),a.jsx("div",{className:s.board,role:"grid","aria-label":"Mathle game board",children:e.board.map((t,c)=>a.jsx("div",{className:`${s.row} ${c===e.currentRow?s.current:""}`,role:"row","aria-label":`Row ${c+1}`,children:t.map((o,b)=>a.jsx("div",{className:`${s.tile} ${o.status} ${c===e.currentRow&&b===e.currentCol?s.current:""}`,role:"gridcell","aria-label":`Position ${b+1}, ${o.value||"empty"}`,tabIndex:0,children:o.value},b))},c))}),_&&a.jsx("div",{className:s.message,role:"alert","aria-live":"assertive",children:_}),a.jsxs("div",{className:s.numberPadContainer,children:[a.jsx("div",{className:s.numberPad,role:"group","aria-label":"Number pad",children:_e.map(t=>a.jsx("button",{className:`${s.numberBtn} ${e.numberPadColors[t]||""}`,onClick:()=>h(t),disabled:e.gameOver,"aria-label":`Enter digit ${t}`,tabIndex:0,children:t},t))}),a.jsxs("div",{className:s.operatorPad,role:"group","aria-label":"Operator pad",children:[a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["+"]||""}`,onClick:()=>h("+"),disabled:e.gameOver,"aria-label":"Enter plus operator",tabIndex:0,children:"+"}),a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["-"]||""}`,onClick:()=>h("-"),disabled:e.gameOver,"aria-label":"Enter minus operator",tabIndex:0,children:"-"}),a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["*"]||""}`,onClick:()=>h("*"),disabled:e.gameOver,"aria-label":"Enter multiply operator",tabIndex:0,children:"*"}),a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["/"]||""}`,onClick:()=>h("/"),disabled:e.gameOver,"aria-label":"Enter divide operator",tabIndex:0,children:"/"}),a.jsx("button",{className:`${s.operatorBtn} ${e.numberPadColors["="]||""}`,onClick:()=>h("="),disabled:e.gameOver,"aria-label":"Enter equals sign",tabIndex:0,children:"="})]}),a.jsxs("div",{className:s.actionButtons,role:"group","aria-label":"Action buttons",children:[a.jsx("button",{className:s.actionBtn,onClick:N,disabled:e.gameOver,"aria-label":"Delete last character",tabIndex:0,children:"âŒ«"}),a.jsx("button",{className:`${s.actionBtn} ${e.currentCol===e.equationLength?s.active:""}`,onClick:k,disabled:e.gameOver||e.currentCol!==e.equationLength,"aria-label":"Submit equation",tabIndex:0,children:"Enter"})]})]})]}),a.jsxs(J,{open:x,onClose:P,title:i.title,children:[a.jsx("p",{children:i.message}),i.stats&&a.jsxs("div",{className:s.stats,children:[a.jsxs("div",{className:s.stat,children:[a.jsx("span",{className:s.statValue,children:i.stats.gamesPlayed}),a.jsx("span",{className:s.statLabel,children:"Games"})]}),a.jsxs("div",{className:s.stat,children:[a.jsxs("span",{className:s.statValue,children:[i.stats.gamesPlayed>0?Math.round(i.stats.gamesWon/i.stats.gamesPlayed*100):0,"%"]}),a.jsx("span",{className:s.statLabel,children:"Win Rate"})]}),a.jsxs("div",{className:s.stat,children:[a.jsx("span",{className:s.statValue,children:i.stats.currentStreak}),a.jsx("span",{className:s.statLabel,children:"Current Streak"})]}),a.jsxs("div",{className:s.stat,children:[a.jsx("span",{className:s.statValue,children:i.stats.maxStreak}),a.jsx("span",{className:s.statLabel,children:"Max Streak"})]})]}),a.jsxs("div",{slot:"buttons",children:[a.jsx("button",{onClick:O,className:s.playAgainBtn,children:"Play Again"}),a.jsx("button",{onClick:P,className:s.closeBtn,children:"Close"})]})]}),a.jsx(R,{})]})};export{Me as default};
